# 05 プルリクエストとコードレビュー

## 目的
- GitHub 上でプルリクエストを作成し、レビュー・マージする流れを学ぶ

## 手順（簡易）
1. feature ブランチを push
2. GitHub 上で New pull request を作成
3. レビューを受けて必要なら修正
4. マージ（Squash/Merge, Rebase などの選択）

## 練習課題
- 自分のリポジトリで PR を作成してマージする

## 詳細（初心者向け）

### プルリクエスト（PR）とは
- PR はブランチ間の変更差分をレビュー・議論し、マージするための GitHub 上の仕組みです。Issue と連携してタスク管理することが多いです。

### PR の作成（GitHub UI）
1. リモートに `feature/xxx` を push: `git push -u origin feature/xxx`
2. GitHub のリポジトリページで `Compare & pull request` をクリック
3. タイトル・説明を書く（どの問題を解決するか、変更点の要約、動作確認方法を記載）
4. レビューアやラベル、関連する Issue を紐づける
5. `Create pull request` を押す

### PR の作成（CLI）
- GitHub CLI (`gh`) を使うと便利です:

```bash
gh auth login
git push -u origin feature/xxx
gh pr create --base main --head feature/xxx --title "Add feature xxx" --body "説明..."
```

### レビューの流れ
1. レビュワーがコメントを付ける
2. 必要な変更をローカルで行いコミットして push（同じブランチに push する）
3. PR に自動で反映されるので再度レビューを依頼
4. 承認（Approve）されたらマージする

### コメントへの対応（ベストプラクティス）
- 変更が必要なコメントには返信し、対応したコミットを push する
- 小さな修正は `fixup` や `--amend` でまとめることも可能（公開済みコミットの書き換えに注意）

### マージ方式の違い
- Merge commit (Create a merge commit): ブランチをそのままマージし、マージコミットを残す。履歴が分かりやすい。
- Squash and merge: feature ブランチの複数コミットを1つにまとめて main にマージする。履歴がシンプルになる。
- Rebase and merge: feature の変更を main の先頭に並べ替えて取り込む。直線的な履歴になるが、公開履歴の書き換えは注意が必要。

選択はプロジェクトのポリシーに従う。個人プロジェクトでは `Squash` が扱いやすいことが多い。

### コンフリクト発生時の対応
1. GitHub 上でコンフリクト表示が出たらローカルで解消するのが一般的
2. 手順例:

```bash
git fetch origin
git switch feature/xxx
git merge origin/main   # または git rebase origin/main
# コンフリクトを編集してから
git add <file>
git commit             # merge の場合
# rebase の場合は git rebase --continue
git push origin feature/xxx
```

### マージ後の作業
- マージ後は不要になった feature ブランチを削除（ローカル `git branch -d feature/xxx`、リモート `git push origin --delete feature/xxx`）
- リリースやタグ付けを行う場合は `git tag` を利用

### Pull Request の便利機能
- Draft PR: 作業中のプルリクエストとして作成し、準備ができたら Ready for review に切り替える
- 自動マージ（Auto-merge）: 条件を満たしたら自動でマージする設定が可能
- CODEOWNERS を使うと特定のディレクトリに対して自動的にレビュワーを割り当てられる

### ブランチ保護（プロジェクト設定）
- `main` などの保護されたブランチに対しては直接 push を禁止し、PR 経由でしかマージできないようにすることで品質を担保できます。

---

次は `06 実践ワークフロー` を詳細化し、チーム開発でのベストプラクティスを追加します。
